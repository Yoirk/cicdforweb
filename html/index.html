<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wandering Tomes</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìñ</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Courier New', Courier, monospace; margin: 0; background: #e9e0d2; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Header gi·ªØ nguy√™n */
        header { background: #fff; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid #5d4037; height: 60px; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .header-btn { font-size: 1.4rem; cursor: pointer; background: none; border: none; transition: transform 0.2s; }
        .header-btn:hover { transform: scale(1.1); }
        .header-right { display: flex; gap: 20px; }

        /* --- BOOKSHELF STYLES --- */
        .library-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e9e0d2; /* M√†u t∆∞·ªùng */
            padding: 20px;
            position: relative;
        }

        .bookshelf {
            width: 800px;
            max-width: 95%;
            background: #5d4037; /* M√†u g·ªó ƒë·∫≠m */
            border: 10px solid #3e2723;
            border-radius: 5px;
            box-shadow: 10px 10px 20px rgba(0,0,0,0.3);
            display: grid;
            grid-template-rows: 1fr 15px 1fr; /* T·∫ßng 1 - K·ªá g·ªó - T·∫ßng 2 */
            padding: 20px;
            position: relative;
            transition: transform 0.5s ease-in-out, opacity 0.5s;
        }

        /* Thanh g·ªó ngƒÉn gi·ªØa */
        .shelf-divider {
            background: #3e2723;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5) inset;
            height: 15px;
            width: 100%;
        }

        .shelf-row {
            display: flex;
            align-items: flex-end; /* S√°ch ƒë·ª©ng tr√™n k·ªá */
            justify-content: space-around;
            padding: 0 10px;
            height: 220px; /* Chi·ªÅu cao t·∫ßng k·ªá */
        }

        /* --- THE BOOK --- */
        .book {
            width: 45px; /* G√°y s√°ch */
            height: 180px;
            background: #8d6e63;
            border-radius: 3px;
            margin: 0 5px;
            cursor: pointer;
            transition: transform 0.2s, height 0.2s;
            position: relative;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            
            /* Text d·ªçc g√°y s√°ch */
            writing-mode: vertical-rl;
            text-orientation: mixed;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px 0;
            color: #fff;
            font-weight: bold;
            font-size: 0.9em;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .book:hover {
            transform: translateY(-5px) scale(1.05);
            z-index: 10;
        }

        /* Random m√†u s√°ch (CSS Variables) */
        .book:nth-child(1n) { background: #c0392b; }
        .book:nth-child(2n) { background: #2980b9; }
        .book:nth-child(3n) { background: #27ae60; }
        .book:nth-child(4n) { background: #8e44ad; }
        .book:nth-child(5n) { background: #d35400; }

        /* N√∫t ƒë·ªïi s√°ch (Refresh) */
        .refresh-btn {
            position: absolute;
            right: -60px;
            top: 50%;
            transform: translateY(-50%);
            background: #5d4037;
            color: #fff;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        .refresh-btn:hover { transform: translateY(-50%) rotate(180deg); }

        /* --- MODAL ƒê·ªåC S√ÅCH (Book Open Effect) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; 
            justify-content: center; align-items: center; z-index: 200;
        }

        .opened-book {
            background: #fff;
            width: 600px;
            height: 400px;
            display: flex;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            animation: openBook 0.5s ease-out;
        }

        @keyframes openBook {
            from { transform: scale(0.1); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .page {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            border-right: 1px solid #ccc;
            background: #fffbf0; /* M√†u gi·∫•y c≈© */
        }
        .page.left { border-right: 2px solid #ddd; }
        .page.right {  }

        .book-close-btn {
            position: absolute; top: 10px; right: 10px;
            background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #555;
        }

        /* --- Utility --- */
        .hidden { display: none; }
        /* Modal Form (Login/Post) d√πng l·∫°i CSS c≈© nh∆∞ng ch·ªânh m√†u cho h·ª£p theme g·ªó */
        .form-modal-content {
            background: #fffbf0; border: 4px solid #5d4037; padding: 30px; width: 90%; max-width: 400px; position: relative;
        }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #8d6e63; background: #fff; }
        button.action-btn { background: #5d4037; color: #fff; border: none; padding: 10px; width: 100%; cursor: pointer; }
    </style>
</head>
<body>

    <header>
        <button class="header-btn" title="Trang ch·ªß"><i class="fa-solid fa-book-open"></i></button>
        <div class="header-right">
            <button class="header-btn" onclick="openAuthModal()"><i class="fa-solid fa-user"></i></button>
        </div>
    </header>

    <div class="library-container">
        <div class="bookshelf" id="bookshelf">
            <div class="shelf-row" id="shelfRow1"></div>
            <div class="shelf-divider"></div>
            <div class="shelf-row" id="shelfRow2"></div>
            
            <button class="refresh-btn" onclick="refreshShelf()" title="ƒê·ªïi s√°ch kh√°c">
                <i class="fa-solid fa-arrows-rotate"></i>
            </button>
        </div>
    </div>

    <div class="modal-overlay" id="readModal">
        <div class="opened-book">
            <button class="book-close-btn" onclick="closeReadModal()"><i class="fa-solid fa-xmark"></i></button>
            <div class="page left">
                <h2 style="color: #d35400;" id="readTitle">T√™n S√°ch</h2>
                <p style="font-style: italic; color: #666;">Ng∆∞·ªùi vi·∫øt: <b id="readAuthor">User</b></p>
                <hr style="border-color: #d35400;">
            </div>
            <div class="page right">
                <p id="readContent" style="line-height: 1.6; font-size: 1.1em;">N·ªôi dung chi ti·∫øt...</p>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="authModal">
        <div class="form-modal-content">
            <button style="position:absolute; right:10px; top:5px; border:none; background:none; font-size:1.5rem;" onclick="document.getElementById('authModal').style.display='none'">&times;</button>
            <h3><i class="fa-solid fa-user"></i> T√†i kho·∫£n</h3>
            <p>T√≠nh nƒÉng ƒëƒÉng nh·∫≠p/vi·∫øt b√†i (nh∆∞ c≈©)...</p>
        </div>
    </div>

    <script>
        loadBooks();

        async function loadBooks() {
            try {
                // Hi·ªáu ·ª©ng Fade out k·ªá s√°ch c≈©
                const shelf = document.getElementById('bookshelf');
                shelf.style.opacity = '0';
                
                // G·ªçi API l·∫•y s√°ch (ƒë√£ s·ª≠a backend ƒë·ªÉ GROUP BY)
                let res = await fetch('/api/thoughts/random');
                let data = await res.json();
                
                setTimeout(() => {
                    renderShelf(data.results);
                    shelf.style.opacity = '1'; // Fade in
                }, 500);

            } catch (e) { console.error(e); }
        }

        function renderShelf(books) {
            const row1 = document.getElementById('shelfRow1');
            const row2 = document.getElementById('shelfRow2');
            row1.innerHTML = '';
            row2.innerHTML = '';

            // Chia s√°ch v√†o 2 t·∫ßng
            books.forEach((book, index) => {
                const bookEl = document.createElement('div');
                bookEl.className = 'book';
                // Random ƒë·ªô cao s√°ch cho t·ª± nhi√™n (160px - 190px)
                const height = Math.floor(Math.random() * 30) + 160;
                bookEl.style.height = `${height}px`;
                
                // T√™n s√°ch tr√™n g√°y
                bookEl.innerText = book.book_title.length > 20 ? book.book_title.substring(0,18)+'...' : book.book_title;
                
                // S·ª± ki·ªán Click -> M·ªü s√°ch
                // C·∫ßn encode JSON object ƒë·ªÉ tr√°nh l·ªói k√Ω t·ª± ƒë·∫∑c bi·ªát
                bookEl.onclick = () => openBook(book);

                if (index < 4) row1.appendChild(bookEl);
                else row2.appendChild(bookEl);
            });
        }

        function openBook(book) {
            document.getElementById('readTitle').innerText = book.book_title;
            document.getElementById('readAuthor').innerText = book.username;
            document.getElementById('readContent').innerText = book.content;
            document.getElementById('readModal').style.display = 'flex';
        }

        function closeReadModal() {
            document.getElementById('readModal').style.display = 'none';
        }

        function refreshShelf() {
            // Xoay nh·∫π k·ªá s√°ch ho·∫∑c l√†m hi·ªáu ·ª©ng tr∆∞·ª£t (·ªü ƒë√¢y d√πng opacity cho ƒë∆°n gi·∫£n)
            loadBooks();
        }

        function openAuthModal() {
            document.getElementById('authModal').style.display = 'flex';
        }

        // ƒê√≥ng modal khi click ngo√†i
        window.onclick = function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>